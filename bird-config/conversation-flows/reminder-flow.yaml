# â° Flujo Conversacional de Recordatorios - RobertAI
# Sistema Inteligente de Recordatorios para WhatsApp Business API
# VersiÃ³n: 1.0.0 | Fecha: 2025-09-04

flow_name: "intelligent_reminder_system"
flow_type: "core_functionality"
priority: "highest"
language: "es-LATAM"

# ========================================
# TRIGGERS DE ACTIVACIÃ“N
# ========================================
activation_triggers:
  primary_keywords: ["recordar", "recuÃ©rdame", "recordatorio", "alarma", "avÃ­same"]
  secondary_keywords: ["no olvides", "tengo que", "debo", "importante"]
  intent_patterns:
    - "time_based_task_request"
    - "recurring_activity_setup"
    - "deadline_management"
    - "habit_formation_request"

# ========================================
# ANÃLISIS INTELIGENTE DE SOLICITUDES
# ========================================
request_analysis:
  
  # EXTRACCIÃ“N DE COMPONENTES
  component_extraction:
    task_identification:
      patterns: ["llamar a", "comprar", "pagar", "ir a", "tomar", "hacer"]
      context_analysis: "identify_action_verb_and_object"
      
    time_extraction:
      absolute_time: ["3pm", "15:30", "a las 9", "9 de la maÃ±ana"]
      relative_time: ["en 30 minutos", "maÃ±ana", "la prÃ³xima semana", "en 2 horas"] 
      recurring_patterns: ["todos los dÃ­as", "cada semana", "los lunes", "mensual"]
      contextual_time: ["cuando salga", "antes de dormir", "despuÃ©s del trabajo"]
      
    priority_indicators:
      high_priority: ["urgente", "importante", "crÃ­tico", "no puedo olvidar"]
      medium_priority: ["recordar", "aviso", "tengo que"]
      low_priority: ["si puedes", "cuando tengas chance"]

  # CLASIFICACIÃ“N DE TIPOS DE RECORDATORIO
  reminder_types:
    
    simple_one_time:
      pattern: "accion + tiempo_especÃ­fico"
      examples: 
        - "RecuÃ©rdame llamar al doctor maÃ±ana a las 3pm"
        - "En 2 horas revisar el horno"
      processing_priority: "immediate_scheduling"
      
    recurring_routine:
      pattern: "acciÃ³n + frecuencia_regular"
      examples:
        - "Todos los lunes hacer ejercicio"
        - "Cada dÃ­a tomar mis pastillas a las 8am"
      processing_priority: "pattern_establishment"
      
    conditional_contextual:
      pattern: "acciÃ³n + condiciÃ³n_situacional"
      examples:
        - "Cuando estÃ© cerca del super, comprar leche"
        - "Antes de dormir, poner alarma para maÃ±ana"
      processing_priority: "context_monitoring"
      
    deadline_critical:
      pattern: "tarea + fecha_lÃ­mite_especÃ­fica"
      examples:
        - "Pagar la renta antes del 30"
        - "Entregar proyecto el viernes"
      processing_priority: "deadline_management"

# ========================================
# FLUJOS DE PROCESAMIENTO POR TIPO
# ========================================
processing_flows:
  
  # FLUJO RECORDATORIO SIMPLE
  simple_reminder_flow:
    
    step_1_confirmation:
      message_template: |
        Â¡Perfecto! â° Entiendo que quieres que te recuerde:
        
        **ğŸ“‹ {extracted_task}**
        **ğŸ• {extracted_time}**
        
        Â¿Todo correcto asÃ­?
        
      interactive_options:
        - text: "âœ… Perfecto"
          action: "confirm_and_schedule"
        - text: "ğŸ”„ Cambiar hora"
          action: "modify_time"  
        - text: "ğŸ“ Cambiar tarea"
          action: "modify_task"

    step_2_scheduling_confirmation:
      success_message: |
        âœ… **Â¡Listo!** Tu recordatorio estÃ¡ programado:
        
        ğŸ“ **{task_description}**
        ğŸ• **{scheduled_datetime}**
        
        {additional_context_message}
        
        Â¿Necesitas agregar algo mÃ¡s al recordatorio?

      additional_context_options:
        - text: "ğŸ“ Agregar ubicaciÃ³n"
          action: "add_location_context"
        - text: "ğŸ‘¥ Involucrar a alguien mÃ¡s"
          action: "add_person_context"
        - text: "âœ… EstÃ¡ perfecto asÃ­"
          action: "finalize_reminder"

  # FLUJO RECORDATORIO RECURRENTE
  recurring_reminder_flow:
    
    step_1_pattern_confirmation:
      message_template: |
        ğŸ”„ **Recordatorio recurrente detectado:**
        
        **ğŸ“‹ Actividad:** {activity}
        **â° Frecuencia:** {frequency_pattern}
        **ğŸ• Horario:** {time_pattern}
        
        Â¿Es asÃ­ como lo quieres programado?

      pattern_options:
        - text: "âœ… Perfecto asÃ­"
          action: "setup_recurring_pattern"
        - text: "ğŸ“… Cambiar dÃ­as"
          action: "modify_frequency"
        - text: "ğŸ• Cambiar horario" 
          action: "modify_recurring_time"

    step_2_recurrence_details:
      detail_gathering:
        start_date: "Â¿Desde cuÃ¡ndo empezamos con este recordatorio?"
        end_condition: "Â¿Hasta cuÃ¡ndo o indefinidamente?"
        skip_options: "Â¿QuÃ© hago si hay feriados o fines de semana?"
        
      confirmation_message: |
        ğŸ¯ **Recordatorio recurrente configurado:**
        
        ğŸ”„ **{activity}** cada **{frequency}** a las **{time}**
        ğŸ“… Desde: **{start_date}**
        ğŸ Hasta: **{end_condition}**
        
        **Primera activaciÃ³n:** {next_reminder_date}
        
        Â¡Todo programado! ğŸ’ª

  # FLUJO RECORDATORIO CONTEXTUAL
  contextual_reminder_flow:
    
    step_1_context_analysis:
      context_types:
        location_based:
          trigger_example: "cuando estÃ© cerca del super"
          setup_message: |
            ğŸ“ **Recordatorio por ubicaciÃ³n:**
            
            Te voy a avisar sobre **{task}** cuando estÃ©s cerca de **{location}**.
            
            Â¿Necesitas que sea mÃ¡s especÃ­fico sobre la distancia?
            
          location_options:
            - text: "ğŸ“ UbicaciÃ³n exacta"
              action: "set_precise_location"
            - text: "ğŸŒ Ãrea general"
              action: "set_general_area"
              
        time_context_based:
          trigger_example: "antes de dormir"
          setup_message: |
            ğŸŒ™ **Recordatorio contextual:**
            
            Te recordarÃ© **{task}** **{time_context}**.
            
            Â¿A quÃ© hora suele ser eso para ti?

    step_2_context_setup:
      location_setup:
        precise_location: "Comparte tu ubicaciÃ³n o dime la direcciÃ³n exacta"
        general_area: "Â¿En quÃ© zona o cerca de quÃ© lugar?"
        
      time_context_setup:
        routine_mapping: "Â¿A quÃ© hora sueles {context_activity}?"
        flexibility_options: "Â¿Rango de tiempo flexible o hora especÃ­fica?"

# ========================================
# GESTIÃ“N INTELIGENTE DE RECORDATORIOS
# ========================================
intelligent_management:
  
  # SUGERENCIAS PROACTIVAS
  proactive_suggestions:
    
    buffer_time_suggestions:
      medical_appointments: "Te sugiero recordarte 1 hora antes para llegar con tiempo y evitar trÃ¡fico"
      payment_deadlines: "Â¿Programo recordatorio 3 dÃ­as antes para que verifiques tu saldo?"
      social_events: "Â¿TambiÃ©n te recuerdo comprar regalo/confirmar asistencia?"
      
    related_task_suggestions:
      medication_reminders: "Â¿TambiÃ©n te recuerdo renovar la receta cuando se estÃ© acabando?"
      exercise_reminders: "Â¿Quieres que considere el clima para sugerir alternativas?"
      meeting_reminders: "Â¿Te ayudo a recordar preparar la presentaciÃ³n/documentos?"

  # OPTIMIZACIÃ“N CONTEXTUAL
  context_optimization:
    
    timing_intelligence:
      avoid_sleep_hours: "DetectÃ© que es muy tarde/temprano. Â¿Ajusto el horario?"
      respect_work_schedule: "Es horario laboral, Â¿prefieres antes o despuÃ©s del trabajo?"
      consider_meal_times: "Es hora de comida, Â¿movemos 30min despuÃ©s?"
      
    priority_management:
      conflict_detection: "Tienes otra cita/recordatorio similar. Â¿CuÃ¡l es mÃ¡s importante?"
      urgency_escalation: "Este recordatorio es urgente, Â¿programo recordatorios adicionales?"
      batch_similar_tasks: "Tienes varias tareas similares, Â¿las agrupo para ser mÃ¡s eficiente?"

# ========================================
# EJECUCIÃ“N DE RECORDATORIOS
# ========================================
reminder_execution:
  
  # ENTREGA DE RECORDATORIOS
  delivery_system:
    
    standard_reminder:
      format: |
        ğŸ”” **RECORDATORIO**
        
        â° **Es hora de:** {task_description}
        ğŸ“… **Programado para:** {scheduled_time}
        
        {additional_context}
        
        Â¿Ya estÃ¡ listo o necesitas mÃ¡s tiempo?
        
      response_options:
        - text: "âœ… Listo"
          action: "mark_completed"
        - text: "â° 10 min mÃ¡s"
          action: "snooze_10_minutes"
        - text: "ğŸ“… Reagendar"
          action: "reschedule_reminder"

    urgent_reminder:
      format: |
        ğŸš¨ **RECORDATORIO URGENTE**
        
        âš ï¸ **IMPORTANTE:** {task_description}
        â° **Era para:** {scheduled_time}
        
        {urgency_context}
        
        Â¿QuÃ© quieres hacer?
        
      escalation_options:
        - text: "âœ… Hacerlo ahora"
          action: "mark_in_progress"
        - text: "ğŸ“ Llamar/contactar ya"
          action: "immediate_action_help"
        - text: "â° Reagendar urgente"
          action: "urgent_reschedule"

  # SEGUIMIENTO POST-RECORDATORIO
  follow_up_system:
    
    completion_confirmation:
      success_message: "Â¡Genial! âœ… MarcÃ© como completado: {task}. Â¿Todo saliÃ³ bien?"
      
    failure_support:
      reschedule_offer: "Sin problema ğŸ”„ Â¿Para cuÃ¡ndo lo reagendamos?"
      alternative_solutions: "Â¿Te puedo ayudar de otra manera con {task}?"
      
    learning_feedback:
      timing_optimization: "Â¿El horario estuvo bien o prefieres otro para la prÃ³xima?"
      context_improvement: "Â¿Algo que agregar para futuros recordatorios similares?"

# ========================================
# GESTIÃ“N DE RECORDATORIOS EXISTENTES
# ========================================
reminder_management:
  
  # VISUALIZACIÃ“N DE RECORDATORIOS
  view_reminders:
    
    list_all_reminders:
      command_triggers: ["mis recordatorios", "quÃ© tengo", "lista", "agenda"]
      
      display_format: |
        ğŸ“‹ **TUS RECORDATORIOS ACTIVOS:**
        
        **ğŸ”œ PrÃ³ximos:**
        {upcoming_reminders_list}
        
        **ğŸ”„ Recurrentes:**
        {recurring_reminders_list}
        
        **ğŸ“ Contextuales:**
        {contextual_reminders_list}
        
        Â¿Quieres modificar alguno?
        
    filter_options:
      - text: "ğŸ“… Solo hoy"
        filter: "today_only"
      - text: "ğŸ“† Esta semana"
        filter: "this_week"
      - text: "ğŸ”„ Solo recurrentes"
        filter: "recurring_only"

  # MODIFICACIÃ“N DE RECORDATORIOS
  modify_reminders:
    
    edit_existing:
      selection_method: "interactive_list_with_ids"
      
      modification_options:
        change_time:
          message: "Â¿CuÃ¡l es el nuevo horario para: {reminder_task}?"
          input_type: "natural_time_expression"
          
        change_task:
          message: "Â¿CÃ³mo quieres que cambie la descripciÃ³n?"
          input_type: "free_text_with_confirmation"
          
        change_frequency:
          message: "Â¿Nueva frecuencia para: {reminder_task}?"
          options: ["Diario", "Semanal", "Mensual", "Personalizar"]

    delete_reminders:
      confirmation_required: true
      
      confirmation_message: |
        âš ï¸ **Â¿Seguro que quieres eliminar?**
        
        ğŸ“ **{reminder_to_delete}**
        â° **{scheduled_info}**
        
        Esta acciÃ³n no se puede deshacer.
        
      options:
        - text: "âŒ SÃ­, eliminar"
          action: "confirm_delete"
        - text: "ğŸ”„ No, cancelar"
          action: "cancel_delete"

# ========================================
# CASOS ESPECIALES Y MANEJO DE ERRORES
# ========================================
special_cases:
  
  # RECORDATORIOS PERDIDOS
  missed_reminders:
    
    detection_system:
      trigger: "reminder_not_acknowledged_30min"
      
    recovery_flow:
      escalation_message: |
        âš ï¸ **Recordatorio perdido:**
        
        ğŸ”” **Te recordÃ©:** {missed_task}  
        â° **Era para:** {original_time}
        
        Â¿QuÃ© quieres hacer?
        
      recovery_options:
        - text: "âœ… Ya lo hice"
          action: "mark_late_completion"
        - text: "â° Hacer ahora"
          action: "immediate_execution"
        - text: "ğŸ“… Reprogramar"
          action: "reschedule_missed"
        - text: "âŒ Cancelar"
          action: "cancel_missed"

  # RECORDATORIOS CONFLICTIVOS
  conflict_resolution:
    
    overlap_detection:
      trigger: "two_reminders_within_15min"
      
    resolution_message: |
      âš ï¸ **Conflicto de horarios detectado:**
      
      ğŸ”” **{reminder_1}** - {time_1}
      ğŸ”” **{reminder_2}** - {time_2}
      
      Â¿CÃ³mo lo resolvemos?
      
    resolution_options:
      - text: "â° Espaciar mÃ¡s tiempo"
        action: "auto_space_reminders"
      - text: "ğŸ¯ Priorizar uno"
        action: "prioritize_reminder"
      - text: "âœ… EstÃ¡ bien asÃ­"
        action: "keep_both_close"

  # ERRORES DE INTERPRETACIÃ“N
  interpretation_errors:
    
    ambiguous_time:
      clarification_request: |
        ğŸ¤” **No estoy seguro del horario:**
        
        ğŸ“ EntendÃ­: "{user_input}"
        
        Â¿Te refieres a:
        
      time_options_template:
        - text: "ğŸŒ… {morning_option}"
        - text: "ğŸŒ {afternoon_option}"
        - text: "ğŸŒ™ {evening_option}"
        - text: "ğŸ“ Ser mÃ¡s especÃ­fico"
          action: "request_exact_time"

    unclear_task:
      clarification_request: |
        ğŸ“ **Quiero asegurarme de entender bien:**
        
        Â¿La tarea es exactamente "{interpreted_task}"?
        
        O necesitas que sea mÃ¡s especÃ­fico sobre algo?

# ========================================
# INTEGRACIÃ“N CON CALENDARIO
# ========================================
calendar_integration:
  
  # SINCRONIZACIÃ“N AUTOMÃTICA
  auto_sync:
    
    calendar_events_consideration:
      before_scheduling: "check_calendar_conflicts"
      suggest_buffer: "recommend_travel_time"
      avoid_overlap: "prevent_double_booking"
      
    sync_confirmation:
      message: |
        ğŸ“… **IntegraciÃ³n con tu calendario:**
        
        Â¿Quieres que tambiÃ©n agregue este recordatorio a tu Google Calendar?
        
        AsÃ­ tienes toda tu agenda sincronizada perfectamente.
        
      sync_options:
        - text: "âœ… SÃ­, agregar"
          action: "sync_to_calendar"
        - text: "ğŸ“± Solo WhatsApp"
          action: "whatsapp_only"

  # DETECCIÃ“N DE CONFLICTOS
  conflict_detection:
    
    calendar_clash_warning:
      message: |
        âš ï¸ **Posible conflicto detectado:**
        
        ğŸ”” **Tu recordatorio:** {reminder_task}
        ğŸ“… **Tu calendario muestra:** {calendar_event}
        â° **Mismo horario:** {conflict_time}
        
        Â¿QuÃ© prefieres hacer?
        
      resolution_options:
        - text: "ğŸ“… Mover recordatorio"
          action: "adjust_reminder_time"
        - text: "ğŸ”„ Mover evento calendario"
          action: "suggest_calendar_change"
        - text: "âœ… Mantener ambos"
          action: "keep_both_scheduled"

# ========================================
# MÃ‰TRICAS Y OPTIMIZACIÃ“N
# ========================================
analytics_tracking:
  
  # MÃ‰TRICAS DE EFECTIVIDAD
  effectiveness_metrics:
    - reminder_completion_rate
    - average_response_time_to_reminders
    - reschedule_frequency_by_type
    - user_satisfaction_with_timing
    
  # ANÃLISIS DE PATRONES
  pattern_analysis:
    - most_common_reminder_types
    - optimal_timing_by_user_behavior
    - context_success_rates
    - proactive_suggestion_acceptance
    
  # OPTIMIZACIÃ“N CONTINUA
  continuous_improvement:
    - timing_accuracy_improvement
    - context_understanding_enhancement
    - personalization_effectiveness
    - integration_usage_patterns

# ========================================
# CONFIGURACIÃ“N DE PERSONALIZACIÃ“N
# ========================================
personalization_config:
  
  # ADAPTACIÃ“N POR USUARIO
  user_adaptation:
    
    learning_patterns:
      time_preferences: "detect_preferred_reminder_times"
      communication_style: "adapt_formality_and_emoji_use"  
      task_categories: "identify_most_frequent_reminder_types"
      context_importance: "learn_which_contexts_matter_most"
      
    adaptation_examples:
      morning_person: "Suggest earlier reminders, more energetic tone"
      night_owl: "Avoid early morning, use relaxed evening timing"
      formal_preference: "Reduce emojis, increase professional tone"
      casual_preference: "More emojis, informal language"

  # CONFIGURACIÃ“N AVANZADA
  advanced_settings:
    
    user_configurable_options:
      default_snooze_time: "5min | 10min | 15min | 30min"
      reminder_persistence: "1 reminder | 3 reminders | Until acknowledged"
      context_sensitivity: "High | Medium | Low"
      proactive_suggestions: "Enabled | Disabled"
      
    expert_user_features:
      batch_reminder_creation: "Create multiple reminders from single message"
      template_creation: "Save common reminder patterns"
      advanced_recurrence: "Complex patterns like 'every 2nd Tuesday'"
      integration_preferences: "Auto-sync vs manual approval"

# Fin del flujo de recordatorios