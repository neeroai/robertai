# ğŸ‰ Flujo Conversacional de Bienvenida - RobertAI
# Optimizado para WhatsApp Business API via Bird.com
# VersiÃ³n: 1.0.0 | Fecha: 2025-09-04

flow_name: "welcome_onboarding"
flow_type: "initial_user_interaction"
priority: "highest"
language: "es-LATAM"

# ========================================
# TRIGGERS DE ACTIVACIÃ“N
# ========================================
activation_triggers:
  - first_time_user
  - user_says_hello_after_30_days
  - user_types_specific_keywords: ["hola", "empezar", "ayuda", "inicio"]
  - user_restarts_conversation_explicitly

# ========================================
# FLUJO PRINCIPAL DE BIENVENIDA
# ========================================
conversation_steps:
  
  # PASO 1: SALUDO INICIAL CÃLIDO
  step_1_greeting:
    id: "welcome_01"
    trigger_conditions: ["new_user", "restart_flow"]
    message_type: "text_with_emojis"
    
    message_content: |
      Â¡Hola! ğŸ‘‹ Soy **Robert**, tu asistente personal inteligente.
      
      Me da mucho gusto conocerte! Estoy aquÃ­ para hacerte la vida mÃ¡s fÃ¡cil y organizada. ğŸ˜Š
    
    wait_for_response: false
    auto_continue: true
    delay_seconds: 2

  # PASO 2: PRESENTACIÃ“N DE CAPACIDADES
  step_2_capabilities:
    id: "welcome_02"
    message_type: "text_with_interactive_buttons"
    
    message_content: |
      âœ¨ **Â¿En quÃ© te puedo ayudar?**
      
      â€¢ â° **Recordatorios inteligentes** (Ãºnicos y recurrentes)
      â€¢ ğŸ“… **Agendamiento automÃ¡tico** de citas y reservas  
      â€¢ ğŸ“¸ **AnÃ¡lisis de imÃ¡genes** y documentos
      â€¢ ğŸµ **TranscripciÃ³n de audios** a texto
      â€¢ ğŸ’¬ **MensajerÃ­a programada** 24/7
      â€¢ ğŸ—“ï¸ **SincronizaciÃ³n con Google Calendar**
      
      Â¡Puedes escribirme, enviarme fotos o audios - proceso todo! ğŸš€

    interactive_buttons:
      - text: "ğŸš€ Â¡Empezar ahora!"
        payload: "START_USING"
      - text: "ğŸ“‹ Ver ejemplos"
        payload: "SHOW_EXAMPLES"  
      - text: "â“ Tengo preguntas"
        payload: "HAVE_QUESTIONS"

    wait_for_response: true
    timeout_seconds: 120
    timeout_action: "proceed_to_examples"

  # RAMAS DEL FLUJO SEGÃšN RESPUESTA
  branches:
    
    # RAMA A: Usuario quiere empezar inmediatamente
    start_using_branch:
      trigger_payload: "START_USING"
      
      response_message: |
        Â¡Excelente! ğŸ¯ Me encanta tu actitud.
        
        **Para empezar, solo dime quÃ© necesitas:**
        
        ğŸ“ *Ejemplos que entiendo perfectamente:*
        â€¢ "RecuÃ©rdame llamar a mamÃ¡ maÃ±ana a las 7pm"
        â€¢ "AyÃºdame a agendar con el dentista" 
        â€¢ [Enviar foto de una factura]
        â€¢ [Mandar audio con instrucciones]
        
        Â¡Habla conmigo como le hablas a un amigo! ğŸ˜Š
      
      interactive_buttons:
        - text: "â° Crear recordatorio"
          payload: "CREATE_REMINDER"
        - text: "ğŸ“… Agendar algo"
          payload: "SCHEDULE_APPOINTMENT"
        - text: "ğŸ“¸ Analizar imagen"
          payload: "ANALYZE_IMAGE_INSTRUCTION"

      next_step: "handle_first_task"

    # RAMA B: Usuario quiere ver ejemplos
    show_examples_branch:
      trigger_payload: "SHOW_EXAMPLES"
      
      response_message: |
        Â¡Perfecto! ğŸ“‹ Te muestro exactamente lo que puedo hacer:
        
        **ğŸ”¥ Casos reales de usuarios:**
        
        ğŸ’Š **"RecuÃ©rdame tomar mis pastillas todos los dÃ­as a las 8am"**
        â¤ *Programo recordatorio diario con confirmaciÃ³n*
        
        ğŸ¦· **"Necesito cita con el dentista esta semana"**  
        â¤ *Te ayudo a coordinar horarios y te doy toda la info*
        
        ğŸ“¸ **[Foto de factura de luz]**
        â¤ *"Veo que vence el 20 de marzo, Â¿programo recordatorio?"*
        
        ğŸµ **[Audio: "Robert, organÃ­zame todo para maÃ±ana"]**
        â¤ *Transcribo y organizo cada tarea automÃ¡ticamente*

      interactive_buttons:
        - text: "Â¡Quiero probar!"
          payload: "START_USING"
        - text: "ğŸ¤” MÃ¡s ejemplos"
          payload: "MORE_EXAMPLES"

      next_step: "wait_for_choice"

    # RAMA C: Usuario tiene preguntas
    have_questions_branch:
      trigger_payload: "HAVE_QUESTIONS"
      
      response_message: |
        Â¡Claro! ğŸ’­ PregÃºntame lo que quieras. Estas son las mÃ¡s comunes:
        
        **â“ Preguntas frecuentes:**
        â€¢ "Â¿CÃ³mo funciona exactamente?"
        â€¢ "Â¿Es seguro? Â¿QuÃ© pasa con mi informaciÃ³n?"
        â€¢ "Â¿Puedo cancelar recordatorios?"
        â€¢ "Â¿Funciona con mi calendario actual?"
        â€¢ "Â¿EstÃ¡ disponible 24/7?"
        
        **O pregÃºntame cualquier cosa que tengas en mente** ğŸ¤—
        
        Â¡No hay preguntas tontas, solo respuestas Ãºtiles!

      interactive_buttons:
        - text: "ğŸ”’ Privacidad/Seguridad"
          payload: "PRIVACY_QUESTIONS"
        - text: "âš™ï¸ CÃ³mo funciona"
          payload: "HOW_IT_WORKS"
        - text: "âœ… Listo, empezar"
          payload: "START_USING"

      next_step: "handle_questions"

# ========================================
# MANEJO DE PREGUNTAS ESPECÃFICAS
# ========================================
question_handlers:
  
  privacy_questions:
    trigger_payload: "PRIVACY_QUESTIONS"
    message_type: "informative_reassuring"
    
    response_content: |
      ğŸ›¡ï¸ **Tu privacidad es sagrada para mÃ­:**
      
      âœ… **Lo que SÃ hago:**
      â€¢ Recuerdo nuestras conversaciones para ayudarte mejor
      â€¢ Guardo tus preferencias (horarios favoritos, etc.)
      â€¢ Mantengo todo encriptado y super seguro
      
      âŒ **Lo que NUNCA harÃ©:**
      â€¢ Compartir tu informaciÃ³n con nadie
      â€¢ Vender tus datos (Â¡jamÃ¡s!)
      â€¢ Acceder a tus otros chats de WhatsApp
      â€¢ Recordar cosas que me pidas olvidar
      
      **ğŸ›ï¸ Tienes control total:** Puedes pedirme que olvide algo especÃ­fico cuando quieras.

    follow_up_buttons:
      - text: "ğŸ‘ Perfecto, empezar"
        payload: "START_USING"
      - text: "ğŸ¤” MÃ¡s preguntas"
        payload: "MORE_QUESTIONS"

  how_it_works:
    trigger_payload: "HOW_IT_WORKS"
    
    response_content: |
      ğŸ§  **Es sÃºper sencillo, funciono con IA avanzada:**
      
      **1ï¸âƒ£ Me escribes naturalmente** 
      *"RecuÃ©rdame X cosa" o me mandas foto/audio*
      
      **2ï¸âƒ£ Yo entiendo el contexto** 
      *No solo las palabras, sino lo que realmente necesitas*
      
      **3ï¸âƒ£ Te ayudo inmediatamente**
      *Con confirmaciÃ³n clara de lo que harÃ©*
      
      **4ï¸âƒ£ Ejecuto perfectamente**
      *Recordatorios puntuales, seguimiento inteligente*
      
      **ğŸ¯ La magia:** Hablas conmigo como con un amigo sÃºper organizado que nunca olvida nada.

    follow_up_buttons:
      - text: "ğŸš€ Â¡Vamos a probarlo!"
        payload: "START_USING"
      - text: "ğŸ“± Â¿Funciona 24/7?"
        payload: "AVAILABILITY_QUESTION"

# ========================================
# MANEJO DE PRIMERA TAREA
# ========================================
first_task_handlers:
  
  create_reminder_guide:
    trigger_payload: "CREATE_REMINDER"
    
    guidance_message: |
      â° **Â¡Perfecto! Vamos a crear tu primer recordatorio.**
      
      **Solo dime quÃ© y cuÃ¡ndo:**
      
      ğŸ’¬ *Ejemplos que funcionan perfecto:*
      â€¢ "En 30 minutos recuÃ©rdame revisar el horno"
      â€¢ "MaÃ±ana a las 9am llamar al doctor"  
      â€¢ "Todos los lunes hacer ejercicio"
      â€¢ "El 15 de marzo pagar la renta"
      
      **Â¡Escribe tu recordatorio ahora!** ğŸ‘‡

    wait_for_input: true
    input_type: "natural_language_reminder"
    process_with: "reminder_creation_flow"

  schedule_appointment_guide:
    trigger_payload: "SCHEDULE_APPOINTMENT"
    
    guidance_message: |
      ğŸ“… **Â¡Genial! Te ayudo a agendar lo que necesites.**
      
      **Â¿QuÃ© tipo de cita es?**
      
      ğŸ¥ *MÃ©dicas:* Doctor, dentista, especialista
      âœ‚ï¸ *Personales:* PeluquerÃ­a, barberÃ­a, spa  
      ğŸ½ï¸ *Sociales:* Restaurante, eventos
      ğŸ”§ *Servicios:* Plomero, electricista, limpieza
      
      **Solo dime quÃ© necesitas agendar** ğŸ‘‡

    interactive_buttons:
      - text: "ğŸ¥ Cita mÃ©dica"
        payload: "MEDICAL_APPOINTMENT"
      - text: "âœ‚ï¸ Servicio personal"  
        payload: "PERSONAL_SERVICE"
      - text: "ğŸ½ï¸ Reserva social"
        payload: "SOCIAL_RESERVATION"
      - text: "ğŸ”§ Servicio hogar"
        payload: "HOME_SERVICE"

    next_step: "appointment_type_handler"

  analyze_image_instruction:
    trigger_payload: "ANALYZE_IMAGE_INSTRUCTION"
    
    instruction_message: |
      ğŸ“¸ **Â¡Excelente! Puedo analizar cualquier imagen.**
      
      **ğŸ“‹ Lo que proceso perfectamente:**
      â€¢ Facturas y recibos (extraigo fechas y montos)
      â€¢ MenÃºs de restaurantes 
      â€¢ Documentos importantes
      â€¢ Screenshots de mensajes
      â€¢ Notas escritas a mano
      â€¢ Â¡Y mucho mÃ¡s!
      
      **ğŸ“¤ Simplemente envÃ­a tu imagen y yo me encargo del resto.**
      
      *Te dirÃ© quÃ© veo y quÃ© puedo hacer por ti* âœ¨

    wait_for_media: true
    media_type: "image"
    process_with: "image_analysis_flow"

# ========================================
# CONFIGURACIÃ“N DE PERSONALIZACIÃ“N
# ========================================
personalization_setup:
  
  collect_preferences:
    when_triggered: "after_first_successful_task"
    
    preference_questions:
      - question: "ğŸ• **Â¿A quÃ© hora sueles estar mÃ¡s activo?** (para sugerir mejor horarios)"
        options: ["MaÃ±ana (6am-12pm)", "Tarde (12pm-6pm)", "Noche (6pm-12am)", "Variable"]
        
      - question: "ğŸ“ **Â¿En quÃ© zona vives principalmente?** (para sugerencias locales)"
        input_type: "free_text_optional"
        
      - question: "â° **Â¿Prefieres recordatorios con anticipaciÃ³n o justo a tiempo?**"
        options: ["Con tiempo (30min-1hr antes)", "Justo a tiempo", "Depende del tipo"]

    personalization_confirmation: |
      Â¡Perfecto! ğŸ¯ Ya tengo tu perfil bÃ¡sico.
      
      Ahora mis sugerencias serÃ¡n mucho mÃ¡s personalizadas para ti.
      
      **Â¿Algo mÃ¡s en lo que te pueda ayudar hoy?** ğŸ˜Š

# ========================================
# MENSAJES DE FINALIZACIÃ“N
# ========================================
completion_messages:
  
  successful_onboarding: |
    ğŸ‰ **Â¡Bienvenido oficialmente al equipo, {user_name}!**
    
    Ya estÃ¡s completamente configurado. Desde ahora:
    
    âœ… **Puedes escribirme cuando quieras**
    âœ… **Enviarme fotos, audios o documentos** 
    âœ… **Pedirme cualquier recordatorio o cita**
    âœ… **Contar conmigo 24/7 para organizarte**
    
    **ğŸ’¡ Tip pro:** Mientras mÃ¡s me uses, mejor te entiendo y mÃ¡s personalizada es mi ayuda.
    
    Â¡A hacerte la vida mÃ¡s fÃ¡cil! ğŸš€

  partial_onboarding: |
    ğŸ‘ **Perfecto, ya estÃ¡s listo para usar RobertAI.**
    
    Recuerda que puedes:
    â€¢ Escribirme naturalmente cualquier cosa
    â€¢ Enviar imÃ¡genes, audios o documentos
    â€¢ Pedirme ayuda cuando la necesites
    
    **Â¡Estoy aquÃ­ 24/7 para ti!** ğŸ˜Š

# ========================================
# CONFIGURACIÃ“N DE REACTIVACIÃ“N
# ========================================
reactivation_flow:
  
  returning_user_greeting:
    trigger_condition: "user_inactive_30_plus_days"
    
    message: |
      Â¡Hola de nuevo! ğŸ‘‹ Â¡QuÃ© gusto verte por aquÃ­!
      
      Soy Robert, tu asistente personal. Â¿Te acuerdas de mÃ­? ğŸ˜Š
      
      **Â¿En quÃ© te puedo ayudar hoy?**
      
      Si necesitas refrescar la memoria de lo que puedo hacer, solo pregÃºntame.

    quick_options:
      - text: "Â¡SÃ­ me acuerdo! AyÃºdame con algo"
        payload: "CONTINUE_NORMAL"
      - text: "RecuÃ©rdame quÃ© puedes hacer"
        payload: "SHOW_CAPABILITIES_AGAIN"

# ========================================
# CONFIGURACIÃ“N DE ERRORES Y FALLBACKS
# ========================================
error_handling:
  
  user_confusion:
    trigger_keywords: ["no entiendo", "confuso", "quÃ©", "cÃ³mo"]
    
    clarification_response: |
      Â¡No te preocupes! ğŸ˜… A veces no soy sÃºper claro.
      
      **Te explico de nuevo sÃºper simple:**
      
      1ï¸âƒ£ **Me escribes lo que necesitas** (como hablarle a un amigo)
      2ï¸âƒ£ **Yo te entiendo y te ayudo**
      3ï¸âƒ£ **Â¡Listo!** 
      
      **Â¿QuÃ© te gustarÃ­a probar primero?**

    simple_options:
      - text: "Un recordatorio simple"
        payload: "SIMPLE_REMINDER"
      - text: "Ayuda con una cita"
        payload: "SIMPLE_APPOINTMENT"

  technical_issues:
    trigger_conditions: ["message_delivery_failure", "processing_timeout"]
    
    recovery_message: |
      Â¡Ups! ğŸ˜… Parece que algo fallÃ³ tÃ©cnicamente.
      
      **Vamos a intentar de nuevo:**
      
      â€¢ Â¿PodrÃ­as repetir lo que necesitabas?
      â€¢ O si prefieres, escribe "REINICIAR" y empezamos fresco
      
      Â¡Siempre encuentro la forma de ayudarte! ğŸ’ª

# ========================================
# MÃ‰TRICAS Y ANÃLISIS
# ========================================
analytics_tracking:
  
  conversion_events:
    - welcome_flow_completed
    - first_task_completed
    - personalization_completed
    - user_returned_after_onboarding
    
  engagement_metrics:
    - time_to_first_interaction
    - completion_rate_by_step
    - most_chosen_first_task
    - user_questions_frequency
    
  optimization_points:
    - message_clarity_testing
    - button_placement_effectiveness 
    - personalization_impact_measurement
    - user_satisfaction_post_onboarding

# Fin del flujo de bienvenida